<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/modules/popupFilter.js | tablefilter v0.1.15 API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/koalyptus/TableFilter.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/emitter.js~Emitter.html">Emitter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/tablefilter.js~TableFilter.html">TableFilter</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">extensions/advancedGrid</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/extensions/advancedGrid/adapterEzEditTable.js~AdapterEzEditTable.html">AdapterEzEditTable</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">extensions/colOps</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/extensions/colOps/colOps.js~ColOps.html">ColOps</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">extensions/colsVisibility</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/extensions/colsVisibility/colsVisibility.js~ColsVisibility.html">ColsVisibility</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">extensions/filtersVisibility</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/extensions/filtersVisibility/filtersVisibility.js~FiltersVisibility.html">FiltersVisibility</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">extensions/sort</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/extensions/sort/adapterSortabletable.js~AdapterSortableTable.html">AdapterSortableTable</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">modules</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/alternateRows.js~AlternateRows.html">AlternateRows</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/checkList.js~CheckList.html">CheckList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/clearButton.js~ClearButton.html">ClearButton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/dropdown.js~Dropdown.html">Dropdown</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/feature.js~Feature.html">Feature</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/gridLayout.js~GridLayout.html">GridLayout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/help.js~Help.html">Help</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/highlightKeywords.js~HighlightKeyword.html">HighlightKeyword</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/loader.js~Loader.html">Loader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/noResults.js~NoResults.html">NoResults</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/paging.js~Paging.html">Paging</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/popupFilter.js~PopupFilter.html">PopupFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/rowsCounter.js~RowsCounter.html">RowsCounter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/statusBar.js~StatusBar.html">StatusBar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/modules/store.js~Store.html">Store</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/modules/popupFilter.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import {Feature} from &apos;./feature&apos;;
import Types from &apos;../types&apos;;
import Dom from &apos;../dom&apos;;
import Event from &apos;../event&apos;;

export class PopupFilter extends Feature{

    /**
     * Pop-up filter component
     * @param {Object} tf TableFilter instance
     */
    constructor(tf){
        super(tf, &apos;popupFilters&apos;);

        // Configuration object
        var f = this.config;

        // Enable external filters
        tf.isExternalFlt = true;
        tf.externalFltTgtIds = [];

        //filter icon path
        this.popUpImgFlt = f.popup_filters_image ||
            tf.themesPath+&apos;icn_filter.gif&apos;;
        //active filter icon path
        this.popUpImgFltActive = f.popup_filters_image_active ||
            tf.themesPath+&apos;icn_filterActive.gif&apos;;
        this.popUpImgFltHtml = f.popup_filters_image_html ||
            &apos;&lt;img src=&quot;&apos;+ this.popUpImgFlt +&apos;&quot; alt=&quot;Column filter&quot; /&gt;&apos;;
        //defines css class for popup div containing filter
        this.popUpDivCssClass = f.popup_div_css_class || &apos;popUpFilter&apos;;
        //callback function before popup filtes is opened
        this.onBeforePopUpOpen = Types.isFn(f.on_before_popup_filter_open) ?
            f.on_before_popup_filter_open : null;
        //callback function after popup filtes is opened
        this.onAfterPopUpOpen = Types.isFn(f.on_after_popup_filter_open) ?
            f.on_after_popup_filter_open : null;
        //callback function before popup filtes is closed
        this.onBeforePopUpClose =
            Types.isFn(f.on_before_popup_filter_close) ?
            f.on_before_popup_filter_close : null;
        //callback function after popup filtes is closed
        this.onAfterPopUpClose = Types.isFn(f.on_after_popup_filter_close) ?
            f.on_after_popup_filter_close : null;

        //stores filters spans
        this.popUpFltSpans = [];
        //stores filters icons
        this.popUpFltImgs = [];
        //stores filters containers
        this.popUpFltElms = this.popUpFltElmCache || [];
        this.popUpFltAdjustToContainer = true;

        //id prefix for pop-up filter span
        this.prfxPopUpSpan = &apos;popUpSpan_&apos;;
        //id prefix for pop-up div containing filter
        this.prfxPopUpDiv = &apos;popUpDiv_&apos;;
    }

    onClick(e){
        var evt = e || global.event,
            elm = evt.target.parentNode,
            colIndex = parseInt(elm.getAttribute(&apos;ci&apos;), 10);

        this.closeAll(colIndex);
        this.toggle(colIndex);

        if(this.popUpFltAdjustToContainer){
            var popUpDiv = this.popUpFltElms[colIndex],
                header = this.tf.getHeaderElement(colIndex),
                headerWidth = header.clientWidth * 0.95;
            popUpDiv.style.width = parseInt(headerWidth, 10) + &apos;px&apos;;
        }
        Event.cancel(evt);
        Event.stop(evt);
    }

    /**
     * Initialize DOM elements
     */
    init(){
        if(this.initialized){
            return;
        }

        var tf = this.tf;

        // Override headers row index if no grouped headers
        if(tf.headersRow &lt;= 1){
            tf.headersRow = 0;
        }

        for(var i=0; i&lt;tf.nbCells; i++){
            if(tf.getFilterType(i) === tf.fltTypeNone){
                continue;
            }
            var popUpSpan = Dom.create(
                &apos;span&apos;,
                [&apos;id&apos;, this.prfxPopUpSpan+tf.id+&apos;_&apos;+i],
                [&apos;ci&apos;, i]
            );
            popUpSpan.innerHTML = this.popUpImgFltHtml;
            var header = tf.getHeaderElement(i);
            header.appendChild(popUpSpan);
            Event.add(popUpSpan, &apos;click&apos;, (evt) =&gt; { this.onClick(evt); });
            this.popUpFltSpans[i] = popUpSpan;
            this.popUpFltImgs[i] = popUpSpan.firstChild;
        }

        // subscribe to events
        this.emitter.on([&apos;before-filtering&apos;], ()=&gt; this.buildIcons());
        this.emitter.on([&apos;after-filtering&apos;], ()=&gt; this.closeAll());
        this.emitter.on([&apos;cell-processed&apos;],
            (tf, cellIndex)=&gt; this.buildIcon(cellIndex, true));
        this.emitter.on([&apos;filters-row-inserted&apos;], ()=&gt; this.tf.headersRow++);
        this.emitter.on([&apos;before-filter-init&apos;],
            (tf, colIndex)=&gt; this.build(colIndex));

        this.initialized = true;
    }

    /**
     * Reset previously destroyed feature
     */
    reset(){
        this.enable();
        this.init();
        this.buildAll();
    }

    /**
     * Build all pop-up filters elements
     */
    buildAll(){
        for(var i=0; i&lt;this.popUpFltElmCache.length; i++){
            this.build(i, this.popUpFltElmCache[i]);
        }
    }

    /**
     * Build a specified pop-up filter elements
     * @param  {Number} colIndex Column index
     * @param  {Object} div      Optional container DOM element
     */
    build(colIndex, div){
        var tf = this.tf;
        var popUpDiv = !div ?
            Dom.create(&apos;div&apos;, [&apos;id&apos;, this.prfxPopUpDiv+tf.id+&apos;_&apos;+colIndex]) :
            div;
        popUpDiv.className = this.popUpDivCssClass;
        tf.externalFltTgtIds.push(popUpDiv.id);
        var header = tf.getHeaderElement(colIndex);
        header.insertBefore(popUpDiv, header.firstChild);
        Event.add(popUpDiv, &apos;click&apos;, (evt) =&gt; Event.stop(evt));
        this.popUpFltElms[colIndex] = popUpDiv;
    }

    /**
     * Toogle visibility of specified filter
     * @param  {Number} colIndex Column index
     */
    toggle(colIndex){
        var tf = this.tf,
            popUpFltElm = this.popUpFltElms[colIndex];

        if(popUpFltElm.style.display === &apos;none&apos; ||
            popUpFltElm.style.display === &apos;&apos;){
            if(this.onBeforePopUpOpen){
                this.onBeforePopUpOpen.call(
                    null, this, this.popUpFltElms[colIndex], colIndex);
            }
            popUpFltElm.style.display = &apos;block&apos;;
            if(tf.getFilterType(colIndex) === tf.fltTypeInp){
                var flt = tf.getFilterElement(colIndex);
                if(flt){
                    flt.focus();
                }
            }
            if(this.onAfterPopUpOpen){
                this.onAfterPopUpOpen.call(
                    null, this, this.popUpFltElms[colIndex], colIndex);
            }
        } else {
            if(this.onBeforePopUpClose){
                this.onBeforePopUpClose.call(
                    null, this, this.popUpFltElms[colIndex], colIndex);
            }
            popUpFltElm.style.display = &apos;none&apos;;
            if(this.onAfterPopUpClose){
                this.onAfterPopUpClose.call(
                    null, this, this.popUpFltElms[colIndex], colIndex);
            }
        }
    }

    /**
     * Close all filters excepted for the specified one if any
     * @param  {Number} exceptIdx Column index of the filter to not close
     */
    closeAll(exceptIdx){
        for(var i=0; i&lt;this.popUpFltElms.length; i++){
            if(i === exceptIdx){
                continue;
            }
            var popUpFltElm = this.popUpFltElms[i];
            if(popUpFltElm){
                popUpFltElm.style.display = &apos;none&apos;;
            }
        }
    }

    /**
     * Build all the icons representing the pop-up filters
     */
    buildIcons(){
        for(var i=0; i&lt;this.popUpFltImgs.length; i++){
            this.buildIcon(i, false);
        }
    }

    /**
     * Apply specified icon state
     * @param  {Number} colIndex Column index
     * @param  {Boolean} active   Apply active state
     */
    buildIcon(colIndex, active){
        if(this.popUpFltImgs[colIndex]){
            this.popUpFltImgs[colIndex].src = active ?
                this.popUpImgFltActive : this.popUpImgFlt;
        }
    }

    /**
     * Remove pop-up filters
     */
    destroy(){
        if(!this.initialized){
            return;
        }

        this.popUpFltElmCache = [];
        for(var i=0; i&lt;this.popUpFltElms.length; i++){
            var popUpFltElm = this.popUpFltElms[i],
                popUpFltSpan = this.popUpFltSpans[i],
                popUpFltImg = this.popUpFltImgs[i];
            if(popUpFltElm){
                Dom.remove(popUpFltElm);
                this.popUpFltElmCache[i] = popUpFltElm;
            }
            popUpFltElm = null;
            if(popUpFltSpan){
                Dom.remove(popUpFltSpan);
            }
            popUpFltSpan = null;
            if(popUpFltImg){
                Dom.remove(popUpFltImg);
            }
            popUpFltImg = null;
        }
        this.popUpFltElms = [];
        this.popUpFltSpans = [];
        this.popUpFltImgs = [];

        // unsubscribe to events
        this.emitter.off([&apos;before-filtering&apos;], ()=&gt; this.buildIcons());
        this.emitter.off([&apos;after-filtering&apos;], ()=&gt; this.closeAll());
        this.emitter.off([&apos;cell-processed&apos;],
            (tf, cellIndex)=&gt; this.buildIcon(cellIndex, true));
        this.emitter.off([&apos;filters-row-inserted&apos;], ()=&gt; this.tf.headersRow++);
        this.emitter.off([&apos;before-filter-init&apos;],
            (tf, colIndex)=&gt; this.build(colIndex));

        this.initialized = false;
    }

}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.5)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
